<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../font-awesome-polymer-icons/fa-icons.html">
<dom-module id="cg-base-input">
    <style>
        .wrapper #button {
            padding:0px;
        }
        .wrapper #input {
            width:100%;
            margin-right:5px;
        }
        .wrapper #button ::content iron-icon {
            width:18px;
            height:18px;
        }
        .wrapper {
            @apply(--layout-horizontal);
        }
        .wrapper input {
            @apply(--layout-flex);
        }
    </style>
    <template>
        <div class="wrapper">
            <input tabindex="0" is="iron-input" readonly value$="[[formattedDate]]" disabled$="[[disabled]]" on-focus="_openDialog" on-tap="_openDialog" id="input">
            <paper-icon-button id="button" tabindex="0" icon="fa:calendar-o" on-tap="_openDialog" relative noink disabled$="[[disabled]]"></paper-icon-button>
        </div>
    </template>
</dom-module>
<script>
    Polymer({
        is:'cg-base-input',
        properties:{
            dateFormat:Intl.DateTimeFormat,
            listensTo:{
                type:Array,
                value:[]
            },
            disabled:{
                type:Boolean,
                value:false,
            },
            datetime:{
                type:Date,
                notify:true,
                observer:'datetimeChanged'
            },
            formattedDate:{
                type: String,
                computed:'formatDate(datetime, dateFormat)'
            }
        },
        _pickerDatetime:null,
        _openDialog: function() {
            if(this.disabled) {
                return;
            }
            this.$.picker.open(this._pickerDatetime, function(e){
                this.datetime = e.detail;
                this.fire("date-changed", this.datetime);
            }.bind(this));
        },
        formatDate:function(date, format){
            return date ? this.dateFormat.format(date) : undefined;
        },
        datetimeChanged: function () {
            this._pickerDatetime = this.datetime ? new Date(this.datetime) : null;
        }
    });
</script>