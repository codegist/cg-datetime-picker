<link href="../polymer/polymer.html" rel="import">
<link href="../paper-dialog/paper-action-dialog.html" rel="import">
<link href="../paper-button/paper-button.html" rel="import">
<link href="cg-date-picker.html" rel="import">

<style shim-shadowdom>
    html /deep/ .cg-date-picker-dialog::shadow #scroller {
        width: 624px;
        overflow:hidden;
        padding:0px;
    }
    html /deep/ .cg-date-picker-dialog  {
        font-family:sans-serif;
    }

    html /deep/ .cg-date-picker-dialog::shadow .day {
        font-size:1rem;
    }

    html /deep/ .cg-date-picker-dialog::shadow #actions {
        padding: 0.7rem;
        font-size: 1.2rem;
        color: rgb(0, 150, 136);
        line-height: 1.0rem;
    }
    html /deep/ .cg-date-picker-dialog .datepanel {
        background-color:#009688;
        width:50%;
        font-family: 'Helvetica Neue', Helvetica, Arial, serif;
    }
    html /deep/ .cg-date-picker-dialog .datepanel h2,
    html /deep/ .cg-date-picker-dialog .datepanel h1 {
        margin:0px;
        text-align: center;
        font-weight: normal;
    }
    html /deep/ .cg-date-picker-dialog .datepanel .dayOfWeek,
    html /deep/ .cg-date-picker-dialog .datepanel .monthName,
    html /deep/ .cg-date-picker-dialog .datepanel .dayOfMonth {
        color:#e1e1e1;

    }
    html /deep/ .cg-date-picker-dialog .datepanel .dayOfWeek {
        background-color:#00796b;
        line-height:2.5rem;
        font-size:1.2rem;
    }

    html /deep/ .cg-date-picker-dialog .datepanel .monthName {
        padding-top:2.0rem;
        font-size:1.5rem;
        line-height:1.5rem;
        color:#e1e1e1;
        text-transform:uppercase;
    }

    html /deep/ .cg-date-picker-dialog .datepanel .dayOfMonth {
        font-size:6.1rem;
        line-height:6.1rem;
    }

    html /deep/ .cg-date-picker-dialog .datepanel .year {
        color:rgba(255,255,255,0.5);
        font-size:1.5rem;
        line-height:1.5rem;
    }
</style>
<polymer-element name="cg-date-picker-dialog" attributes="datetime">
    <template>
        <paper-action-dialog id="dialog" class="cg-date-picker-dialog" backdrop layered="true">
            <section layout horizontal id="container">
                <div layout vertical class="datepanel">
                    <h1 class="dayOfWeek">{{ _dayOfWeek }}</h1>
                    <h2 class="monthName">{{ _monthShortName }}</h2>
                    <h1 class="dayOfMonth">{{ _dayOfMonth }}</h1>
                    <h2 class="year">{{ _formattedYear }}</h2>
                </div>
                <cg-date-picker flex datetime="{{_datetime}}" id="datePicker"></cg-date-picker>
            </section>
            <paper-button affirmative>Cancel</paper-button>
            <paper-button affirmative on-tap={{setDate}}>OK</paper-button>
        </paper-action-dialog>
    </template>
    <script>
        (function(){
            var dayOfWeekNames = [
                'Monday',
                'Tuesday',
                'Wednesday',
                'Thursday',
                'Friday',
                'Saturday',
                'Sunday'
            ];

            var monthNames = [
                'JAN',
                'FEB',
                'MAR',
                'APR',
                'MAY',
                'JUN',
                'JUL',
                'AUG',
                'SEP',
                'OCT',
                'NOV',
                'DEC'
            ];
            Polymer('cg-date-picker-dialog', {
                /**
                 * @attribute datetime
                 * @type String
                 * @default null
                 */
                datetime:null,
                /**
                 * Locale setting per the HTML5 Intl API
                 *
                 * @attribute locale
                 * @type Array
                 * @default user system
                 */
                locale: undefined,

                _datetime:null,
                _year:0,
                _dayOfWeek: '',
                _dayOfMonth: 0,
                _monthShortName: '',
                _formattedYear: '',
                _intl: {},

                domReady:function(){
                    // TODO - WHY WE NEED THAT????
                    // TODO - IS IT BECAUSE OF SHADOW DOM THAT core-overlay.html>repositionTarget target.offsetHeight doesn't work as expected??
                    // AND WHY layered="false" doesn't work here???
                    this.$.dialog.addEventListener("core-overlay-open-completed", this.$.dialog.repositionTarget);
                },
                open: function() {
                    this.ready();
                    this.datetimeChanged();
                    this.$.datePicker.ready();
                    this.$.dialog.open();
                },
                localeChanged: function(){
                    this._intl = {};
                    this._intl.dayOfWeek = Intl.DateTimeFormat(this.locale, {weekday: 'long'}).format
                    this._intl.day = Intl.DateTimeFormat(this.locale, {day: 'numeric'}).format;
                    this._intl.shortMonth = Intl.DateTimeFormat(this.locale, {month: 'short'}).format;
                    this._intl.year = Intl.DateTimeFormat(this.locale, {year: 'numeric'}).format;
                },
                _datetimeChanged: function() {
                    this._dayOfWeek = this._intl.dayOfWeek(this._datetime);
                    this._dayOfMonth = this._intl.day(this._datetime);
                    this._monthShortName = this._intl.shortMonth(this._datetime);
                    this._formattedYear = this._intl.year(this._datetime);
                    this.fire('selection-changed', this._datetime);
                },
                datetimeChanged: function(){
                    if(typeof this.datetime == "string"){
                        this._datetime = new Date(this.datetime);
                    }
                },
                ready:function() {
                    this.datetimeChanged();
                    this.localeChanged();
                    this._datetimeChanged();
                },
                _pad:function(num, size) {
                    var s = num+"";
                    while (s.length < size) s = "0" + s;
                    return s;
                },
                setDate:function(){
                    this.datetime = this._datetime.toISOString();
                    this.fire('datetime-changed', this._datetime);
                }

            });
        })();
    </script>
</polymer-element>