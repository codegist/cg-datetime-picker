<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../cg-behaviors/cg-base-behavior.html">
<link rel="import" href="../cg-behaviors/cg-application-context-behavior.html">
<link rel="import" href="../cg-base/cg-validatable-behavior.html">
<link rel="import" href="../cg-base/cg-required-validator.html">
<link rel="import" href="cg-base-input.html">

<dom-module id="cg-datetime-input">
    <template>
        <cg-required-validator required="[[required]]"></cg-required-validator>
        <cg-base-input id="input"
                       disabled="[[disabled]]"
                       date-format="[[dateFormat]]"
                       datetime="{{datetime}}"
                       on-date-changed="onChange"></cg-base-input>
    </template>
</dom-module>
<script>
    Polymer({
        is:'cg-datetime-input',
        properties:{
            disabled:Boolean,
            required:Boolean,
            locale: {
                value:window.navigator.userLanguage || window.navigator.language,
            },
            dateFormat:{
                type:Function,
                value:function(){
                    return Intl.DateTimeFormat(this.locale, {day:'2-digit', month:'2-digit', year:'numeric', hour:'2-digit', minute:'2-digit', hour12:false})
                }
            },
            datetime:{
                type:Date,
                notify:true
            },
            validator: {
                type: String,
                value: 'cg-required-validator'
            }
        },
        behaviors:[CG.BaseBehavior, CG.ApplicationContextBehavior, CG.ValidatableBehavior],
        ready:function(){
            this.$.input.$.picker = this.get("config.datetimeDialog", this.context) || this.importHref(this.resolveUrl("cg-datetime-picker-dialog.html"), function(){
                this.$.input.$.picker = Polymer.dom(this.$.input.root).appendChild(document.createElement('cg-datetime-picker-dialog'));
            });
        },
        onChange:function(e){
            this.fire("input", e.detail);
        }
    });
</script>