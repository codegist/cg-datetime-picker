<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../cg-behaviors/cg-base-behavior.html">
<link rel="import" href="../cg-behaviors/cg-application-context-behavior.html">
<link rel="import" href="../cg-base/cg-validatable-behavior.html">
<link rel="import" href="../cg-base/cg-required-validator.html">
<link rel="import" href="cg-base-input.html">

<dom-module id="cg-date-input">
<template>
    <cg-required-validator required="[[required]]"></cg-required-validator>
    <cg-base-input id="input"
                   disabled="[[disabled]]"
                   date-format="[[dateFormat]]"
                   datetime="{{datetime}}"
                   on-change="onChange"></cg-base-input>
</template>
</dom-module>
<script>
    Polymer({
        is:'cg-date-input',
        properties:{
            disabled:Boolean,
            required:Boolean,
            locale: {
                value:window.navigator.userLanguage || window.navigator.language,
            },
            dateFormat:{
                type:Intl.DateTimeFormat,
                value:function(){
                    return Intl.DateTimeFormat(this.locale, {day:'2-digit', month:'2-digit', year:'numeric'})
                }
            },
            datetime:{
                type:Date,
                notify:true
            },
            validator: {
                type: String,
                value: 'cg-required-validator'
            }
        },
        behaviors:[CG.BaseBehavior, CG.ApplicationContextBehavior, CG.ValidatableBehavior],
        ready:function(){
            this.$.input.$.picker = this.context.dateDialog || this.importHref(this.resolveUrl("cg-date-picker-dialog.html"), function(){
                this.$.input.$.picker = Polymer.dom(this.$.input.root).appendChild(document.createElement('cg-date-picker-dialog'));
            });
        },
        onChange:function(e){
            this.fire("input", e.detail);
        }
    });
</script>